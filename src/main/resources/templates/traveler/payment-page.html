<script src="https://js.stripe.com/v3/"></script>

<h3>Pagamento</h3>

<div id="payment-element"></div>

<button id="submit" class="btn btn-primary mt-3">Paga</button>

<!-- ATTENZIONE: serve th:inline="javascript" !! -->
<script th:inline="javascript">

    // 1️⃣ inserisci la tua PUBLIC KEY qui:
    const stripe = Stripe([[${@environment.getProperty('STRIPE_PUBLIC_KEY')}]]);

    // 2️⃣ Thymeleaf ora può leggere le variabili:
    const clientSecret = /*[[${clientSecret}]]*/ "";
    const bookingId = /*[[${bookingId}]]*/ "";

    console.log("ClientSecret:", clientSecret);
    console.log("BookingId:", bookingId);

    const elements = stripe.elements({ clientSecret });
    const paymentElement = elements.create("payment");
    paymentElement.mount("#payment-element");

    document.getElementById("submit").addEventListener("click", async () => {

        const {error} = await stripe.confirmPayment({
            elements,
            confirmParams: {
                return_url: window.location.origin + "/traveler/payment-success?bookingId=" + bookingId
            }
        });

        if (error) {
            alert(error.message);
        }
    });

</script>
