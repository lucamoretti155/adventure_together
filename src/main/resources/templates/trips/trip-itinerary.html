<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title th:text="${tripItinerary.title}"></title>
    <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}">
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>

<body>
<div th:replace="~{fragments/navbar :: mainNavbar}"></div>

<div th:if="${errorMessage}" class="alert alert-danger" th:text="${errorMessage}"></div>
<div th:if="${successMessage}" class="alert alert-success" th:text="${successMessage}"></div>

<div class="container my-5">

    <!-- TITOLO -->
    <h1 class="fw-bold mb-4" th:text="${tripItinerary.title}"></h1>

    <div class="row">

        <!-- IMMAGINE PRINCIPALE -->
        <div class="col-md-6">
            <img th:src="@{${tripItinerary.picturePath}}"
                 class="img-fluid rounded shadow-sm"
                 style="width: 100%; height: 350px; object-fit: cover; object-position: center;">
        </div>

        <!-- INFO -->
        <div class="col-md-6">
            <h4>Info</h4>

            <p><strong>Durata:</strong> <span th:text="${tripItinerary.durationInDays}"></span> giorni</p>

            <p><strong>Paesi:</strong>
                <span th:each="c, iter : ${countries}">
                    <span th:text="${c.country}"></span><span th:if="${!iter.last}">, </span>
                </span>
            </p>

            <p><strong>Aeroporti di partenza:</strong>
                <span th:each="a, iter : ${departureAirports}">
                    <span th:text="${a.name}"></span><span th:if="${!iter.last}">, </span>
                </span>
            </p>

            <p><strong>Media recensioni:</strong>
                <span th:text="${averageRating} != null ? ${averageRating} : 'N/A' "></span>
            </p>

        </div>
    </div>



    <!-- PROGRAMMA GIORNALIERO -->
    <h3 class="mt-5 fw-bold">Programma di viaggio</h3>
    <div class="mt-3">
        <div class="card mb-3" th:each="day : ${itineraryDays}">
            <div class="card-body">
                <h5 class="fw-bold">
                    Giorno <span th:text="${day.dayNumber}"></span> -
                    <span th:text="${day.title}"></span>
                </h5>
                <p th:text="${day.description}"></p>
            </div>
        </div>
    </div>



    <!-- TRIPS DISPONIBILI -->
    <h3 class="mt-5 fw-bold">Prossime Partenze</h3>
    <div class="row g-4 mt-2">
        <div th:if="${!#authorization.expression('isAuthenticated()')}"><i>Effettua il login per prenotare</i></div>
        <div class="col-md-4" th:each="trip : ${trips}">
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    <p><strong>Partenza:</strong>
                        <span th:text="${#temporals.format(trip.dateDeparture, 'dd/MM/yyyy')}"></span>
                    </p>
                    <p><strong>Ritorno:</strong>
                        <span th:text="${#temporals.format(trip.dateReturn, 'dd/MM/yyyy')}"></span>
                    </p>
                    <p><strong>Prenotabile entro il:</strong>
                        <span th:text="${#temporals.format(trip.dateEndBookings, 'dd/MM/yyyy')}"></span>
                    </p>
                    <p><strong>Posti disponibili:</strong> <span th:text="${trip.maxParticipants - trip.currentParticipantsCount}"></span></p>
                    <p><strong>Costo a persona:</strong>
                        <span th:text="${#numbers.formatDecimal(trip.tripIndividualCost, 1, 'POINT', 2, 'COMMA')}"></span> â‚¬
                    </p>
                    <p><strong>Stato:</strong> <span th:text="${trip.state}"></span></p>

                    <div th:if="${#authorization.expression('hasRole(''TRAVELER'')')}"><a th:href="@{'/bookings/new/' + ${trip.id}}"
                            class="btn btn-primary btn-sm">Prenota</a></div>

                </div>
            </div>
        </div>
    </div>



    <!-- RECENSIONI -->
    <h3 class="mt-5 fw-bold">Recensioni</h3>
    <div class="mt-3">
        <div class="border rounded p-3 mb-3"
             th:each="rev : ${reviews}">
            <p class="fw-bold">Voto: <span th:text="${rev.score}"></span>/5</p>
            <p th:text="${rev.comment}"></p>
        </div>
    </div>

</div>

</body>
</html>
